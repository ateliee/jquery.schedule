"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(T){var i="jqSchedule",v={calcStringTime:function(e){var t=e.split(":");return 60*Number(t[0])*60+60*Number(t[1])},formatTime:function(e){var t=e%3600;return""+Math.floor(e/36e3)+Math.floor(e/3600%10)+":"+(""+Math.floor(t/600)+Math.floor(t/60%10))},_saveSettingData:function(e){return this.data(i+"Setting",e)},_loadSettingData:function(){return this.data(i+"Setting")},_saveData:function(e){var t=T.extend({tableStartTime:0,tableEndTime:0,schedule:[],timeline:[]},e);return this.data(i,t)},_loadData:function(){return this.data(i)},scheduleData:function(){var e=T(this),t=v._loadData.apply(e);return t?t.schedule:[]},timelineData:function(){var e,t=T(this),i=v._loadData.apply(t),a=[];for(e in i.timeline)a[e]=i.timeline[e],a[e].schedule=[];for(e in i.schedule){var n=i.schedule[e];void 0!==n.timeline&&void 0!==a[n.timeline]&&a[n.timeline].schedule.push(n)}return a},resetData:function(){return this.each(function(){var e=T(this),t=v._loadData.apply(e);for(var i in t.schedule=[],v._saveData.apply(e,[t]),e.find(".sc_bar").remove(),t.timeline)t.timeline[i].schedule=[],v._resizeRow.apply(e,[i,0]);v._saveData.apply(e,[t])})},addSchedule:function(i,a){return this.each(function(){var e=T(this),t={start:a.start,end:a.end,startTime:v.calcStringTime(a.start),endTime:v.calcStringTime(a.end),text:a.text,timeline:i};a.data&&(t.data=a.data),v._addScheduleData.apply(e,[i,t]),v._resetBarPosition.apply(e,[i])})},addRow:function(t,i){return this.each(function(){var e=T(this);v._addRow.apply(e,[t,i])})},resetRowData:function(){return this.each(function(){var e=T(this),t=v._loadData.apply(e);t.schedule=[],t.timeline=[],v._saveData.apply(e,[t]),e.find(".sc_bar").remove(),e.find(".timeline").remove(),e.find(".sc_data").height(0)})},setRows:function(i){return this.each(function(){var e=T(this);for(var t in v.resetRowData.apply(e,[]),i)v.addRow.apply(e,[t,i[t]])})},setDraggable:function(i){return this.each(function(){var e=T(this),t=v._loadSettingData.apply(e);i!==t.draggable&&(t.draggable=i,v._saveSettingData.apply(e,t),i?e.find(".sc_bar").draggable("enable"):e.find(".sc_bar").draggable("disable"))})},setResizable:function(i){return this.each(function(){var e=T(this),t=v._loadSettingData.apply(e);i!==t.resizable&&(t.resizable=i,v._saveSettingData.apply(e,t),i?e.find(".sc_bar").resizable("enable"):e.find(".sc_bar").resizable("disable"))})},_getTimeLineNumber:function(e,t){var i=T(this),a=v._loadSettingData.apply(i),n=0,l=0,s=Math.ceil(t/(a.timeLineY+a.timeLinePaddingTop+a.timeLinePaddingBottom));for(var d in a.rows){var r=a.rows[d],o=0;if("object"===_typeof(r.schedule)&&(o=r.schedule.length),e&&e.timeline&&o++,s<=(l+=Math.max(o,1)))break;n++}return n},_addScheduleBgData:function(s){return this.each(function(){var e=T(this),t=v._loadSettingData.apply(e),i=v._loadData.apply(e),a=Math.ceil((s.startTime-i.tableStartTime)/t.widthTime),n=Math.floor((s.endTime-i.tableStartTime)/t.widthTime),l=T('<div class="sc_bgBar"><span class="text"></span></div>');l.css({left:a*t.widthTimeX,top:0,width:(n-a)*t.widthTimeX,height:e.find(".sc_main .timeline").eq(s.timeline).height()}),s.text&&l.find(".text").text(s.text),s.class&&l.addClass(s.class),e.find(".sc_main .timeline").eq(s.timeline).append(l)})},_addScheduleData:function(p,e){var u=e;return u.startTime=u.startTime?u.startTime:v.calcStringTime(u.start),u.endTime=u.endTime?u.endTime:v.calcStringTime(u.end),this.each(function(){var d=T(this),r=v._loadSettingData.apply(d),o=v._loadData.apply(d),e=Math.ceil((u.startTime-o.tableStartTime)/r.widthTime),t=Math.floor((u.endTime-o.tableStartTime)/r.widthTime),i=T('<div class="sc_bar"><span class="head"><span class="time"></span></span><span class="text"></span></div>'),a=v.formatTime(u.startTime),n=v.formatTime(u.endTime),l=v._getScheduleCount.apply(d,[u.timeline]);i.css({left:e*r.widthTimeX,top:l*r.timeLineY+r.timeLinePaddingTop,width:(t-e)*r.widthTimeX,height:r.timeLineY}),i.find(".time").text(a+"-"+n),u.text&&i.find(".text").text(u.text),u.class&&i.addClass(u.class),d.find(".sc_main .timeline").eq(p).append(i),o.schedule.push(u),v._saveData.apply(d,[o]),r.onAppendSchedule&&r.onAppendSchedule.apply(d,[i,u]);var s=o.schedule.length-1;i.data("sc_key",s),i.on("mouseup",function(){if(r.onClick&&!0!==T(this).data("dragCheck")&&!0!==T(this).data("resizeCheck")){var e=T(this),t=e.data("sc_key");r.onClick.apply(d,[e,o.schedule[t]])}});var c=d.find(".sc_bar"),h=null;c.draggable({grid:[r.widthTimeX,1],containment:d.find(".sc_main"),helper:"original",start:function(e,t){var i={};i.node=this,i.offsetTop=t.position.top,i.offsetLeft=t.position.left,i.currentTop=t.position.top,i.currentLeft=t.position.left,i.timeline=v._getTimeLineNumber.apply(d,[h,t.position.top]),i.nowTimeline=i.timeline,h=i},drag:function(e,t){if(T(this).data("dragCheck",!0),!h)return!1;var i=T(this),a=i.data("sc_key"),n=v._getTimeLineNumber.apply(d,[h,t.position.top]);return t.position.left=Math.floor(t.position.left/r.widthTimeX)*r.widthTimeX,h.nowTimeline!==n&&(h.nowTimeline=n),h.currentTop=t.position.top,h.currentLeft=t.position.left,v._rewriteBarText.apply(d,[i,o.schedule[a]]),!0},stop:function(){T(this).data("dragCheck",!1),h=null;var e=T(this),t=e.data("sc_key"),i=e.position().left,a=o.tableStartTime+Math.floor(i/r.widthTimeX)*r.widthTime,n=a+(o.schedule[t].endTime-o.schedule[t].startTime);o.schedule[t].start=v.formatTime(a),o.schedule[t].end=v.formatTime(n),o.schedule[t].startTime=a,o.schedule[t].endTime=n,r.onChange&&r.onChange.apply(d,[e,o.schedule[t]])}});var m=["e"];return r.resizableLeft&&m.push("w"),c.resizable({handles:m.join(","),grid:[r.widthTimeX,r.timeLineY-r.timeBorder],minWidth:r.widthTimeX,containment:d.find(".sc_main_scroll"),start:function(){T(this).data("resizeCheck",!0)},resize:function(e,t){t.element.height(t.size.height),t.element.width(t.size.width)},stop:function(){var e=T(this),t=e.data("sc_key"),i=e.position().left,a=e.outerWidth(),n=o.tableStartTime+Math.floor(i/r.widthTimeX)*r.widthTime,l=o.tableStartTime+Math.floor((i+a)/r.widthTimeX)*r.widthTime,s=o.schedule[t].timeline;o.schedule[t].start=v.formatTime(n),o.schedule[t].end=v.formatTime(l),o.schedule[t].startTime=n,o.schedule[t].endTime=l,v._resetBarPosition.apply(d,[s]),v._rewriteBarText.apply(d,[e,o.schedule[t]]),e.data("resizeCheck",!1),r.onChange&&r.onChange.apply(d,[e,o.schedule[t]])}}),!1===r.draggable&&c.draggable("disable"),!1===r.resizable&&c.resizable("disable"),s})},_getScheduleCount:function(e){var t=T(this),i=v._loadData.apply(t),a=0;for(var n in i.schedule)i.schedule[n].timeline===e&&a++;return a},_addRow:function(u,f){return this.each(function(){var e,s=T(this),i=v._loadSettingData.apply(s),d=v._loadData.apply(s),t=s.find(".sc_main .timeline").length;e="";var a=T(e+='<div class="timeline"></div>');f.title&&a.append('<span class="timeline-title">'+f.title+"</span>"),f.subtitle&&a.append('<span class="timeline-subtitle">'+f.subtitle+"</span>"),i.onInitRow&&i.onInitRow.apply(s,[a,f]),s.find(".sc_data_scroll").append(a),e="";for(var n=T(e+='<div class="timeline"></div>'),l=d.tableStartTime;l<d.tableEndTime;l+=i.widthTime){var r=T('<div class="tl"></div>');r.outerWidth(i.widthTimeX),r.data("time",v.formatTime(l)),r.data("timeline",u),n.append(r)}if(n.find(".tl").on("click",function(){i.onScheduleClick&&i.onScheduleClick.apply(s,[this,T(this).data("time"),T(this).data("timeline"),d.timeline[T(this).data("timeline")]])}),n.find(".tl").on("contextmenu",function(){return i.onScheduleClick&&i.onScheduleClick.apply(s,[this,T(this).data("time"),T(this).data("timeline"),d.timeline[T(this).data("timeline")]]),!1}),s.find(".sc_main").append(n),d.timeline[u]=f,v._saveData.apply(s,[d]),f.class&&""!==f.class&&(s.find(".sc_data .timeline").eq(t).addClass(f.class),s.find(".sc_main .timeline").eq(t).addClass(f.class)),f.schedule)for(var o in f.schedule){var c=f.schedule[o],h=c.start?c.start:v.calcStringTime(c.startTime),m=c.end?c.end:v.calcStringTime(c.endTime),p={};p.start=h,p.end=m,c.text&&(p.text=c.text),p.timeline=u,p.data={},c.data&&(p.data=c.data),v._addScheduleData.apply(s,[t,p])}v._resetBarPosition.apply(s,[t]),s.find(".sc_main .timeline").eq(t).droppable({accept:".sc_bar",drop:function(e,t){var i=t.draggable,a=i.data("sc_key"),n=d.schedule[a].timeline,l=s.find(".sc_main .timeline").index(this);d.schedule[a].timeline=l,i.appendTo(this),v._resetBarPosition.apply(s,[n]),v._resetBarPosition.apply(s,[l])}}),i.onAppendRow&&s.find(".sc_main .timeline").eq(t).find(".sc_bar").each(function(){var e=T(this),t=e.data("sc_key");i.onAppendRow.apply(s,[e,d.schedule[t]])})})},_rewriteBarText:function(d,r){return this.each(function(){var e=T(this),t=v._loadSettingData.apply(e),i=v._loadData.apply(e),a=d.position().left,n=i.tableStartTime+Math.floor(a/t.widthTimeX)*t.widthTime,l=n+(r.endTime-r.startTime),s=v.formatTime(n)+"-"+v.formatTime(l);T(d).find(".time").html(s)})},_resetBarPosition:function(_){return this.each(function(){var e,t,i,a,n,l,s,d,r=T(this),o=v._loadSettingData.apply(r),c=r.find(".sc_main .timeline").eq(_).find(".sc_bar"),h=[],m=[],p=0;for(d=0;d<c.length;d++)h[d]={code:d,x:T(c[d]).position().left};for(h.sort(function(e,t){return e.x<t.x?-1:e.x>t.x?1:0}),d=0;d<h.length;d++){for(i=h[d].code,e=T(c[i]),p=0;p<m.length;p++){for(var u=!1,f=0;f<m[p].length;f++)a=m[p][f],t=T(c[a]),n=e.position().left,s=e.position().left+e.outerWidth(),l=t.position().left,n<t.position().left+t.outerWidth()&&l<s&&(u=!0);if(!u)break}m[p]||(m[p]=[]),e.css({top:p*o.timeLineY+o.timeLinePaddingTop}),m[p][m[p].length]=i}v._resizeRow.apply(r,[_,m.length])})},_resizeRow:function(a,n){return this.each(function(){var e=T(this),t=v._loadSettingData.apply(e),i=Math.max(n,1);e.find(".sc_data .timeline").eq(a).outerHeight(i*t.timeLineY+t.timeLineBorder+t.timeLinePaddingTop+t.timeLinePaddingBottom),e.find(".sc_main .timeline").eq(a).outerHeight(i*t.timeLineY+t.timeLineBorder+t.timeLinePaddingTop+t.timeLinePaddingBottom),e.find(".sc_main .timeline").eq(a).find(".sc_bgBar").each(function(){T(this).outerHeight(T(this).closest(".timeline").outerHeight())}),e.find(".sc_data").outerHeight(e.find(".sc_main_box").outerHeight())})},_resizeWindow:function(){return this.each(function(){var e=T(this),t=v._loadSettingData.apply(e),i=v._loadData.apply(e),a=e.width()-t.dataWidth-t.verticalScrollbar,n=Math.floor((i.tableEndTime-i.tableStartTime)/t.widthTime);e.find(".sc_header_cell").width(t.dataWidth),e.find(".sc_data,.sc_data_scroll").width(t.dataWidth),e.find(".sc_header").width(a),e.find(".sc_main_box").width(a),e.find(".sc_header_scroll").width(t.widthTimeX*n),e.find(".sc_main_scroll").width(t.widthTimeX*n)})},_moveSchedules:function(h,m,p){return this.each(function(){for(var e=T(this),t=v._loadSettingData.apply(e),i=v._loadData.apply(e),a=e.find(".sc_main .timeline").eq(h).find(".sc_bar"),n=0;n<a.length;n++){var l=T(a[n]);if(m.position().left<=l.position().left){var s=l.position().left+t.widthTimeX*p,d=Math.floor((i.tableEndTime-i.tableStartTime)/t.widthTime)*t.widthTimeX-l.outerWidth();l.css({left:Math.max(0,Math.min(s,d))});var r=l.data("sc_key"),o=i.tableStartTime+Math.floor(l.position().left/t.widthTimeX)*t.widthTime,c=o+(i.schedule[r].end-i.schedule[r].start);i.schedule[r].start=v.formatTime(o),i.schedule[r].end=v.formatTime(c),i.schedule[r].startTime=o,i.schedule[r].endTime=c,v._rewriteBarText.apply(e,[l,i.schedule[r]]),t.onChange&&t.onChange.apply(e,[l,i.schedule[r]])}}v._resetBarPosition.apply(e,[h])})},init:function(h){return this.each(function(){var e=T(this),t=T.extend({className:"jq-schedule",rows:{},startTime:"07:00",endTime:"19:30",widthTimeX:25,widthTime:600,timeLineY:50,timeLineBorder:1,timeBorder:1,timeLinePaddingTop:0,timeLinePaddingBottom:0,headTimeBorder:1,dataWidth:160,verticalScrollbar:0,bundleMoveWidth:1,draggable:!0,resizable:!0,resizableLeft:!1,onInitRow:null,onChange:null,onClick:null,onAppendRow:null,onAppendSchedule:null,onScheduleClick:null},h);v._saveSettingData.apply(e,[t]);var i=v.calcStringTime(t.startTime),a=v.calcStringTime(t.endTime);i-=i%t.widthTime,a-=a%t.widthTime,v._saveData.apply(e,[{tableStartTime:i,tableEndTime:a}]);var n='<div class="sc_menu">\n<div class="sc_header_cell"><span>&nbsp;</span></div>\n<div class="sc_header">\n<div class="sc_header_scroll"></div>\n</div>\n</div>\n<div class="sc_wrapper">\n<div class="sc_data">\n<div class="sc_data_scroll"></div>\n</div>\n<div class="sc_main_box">\n<div class="sc_main_scroll">\n<div class="sc_main"></div>\n</div>\n</div>\n</div>';e.append(n),e.addClass(t.className),e.find(".sc_main_box").on("scroll",function(){e.find(".sc_data_scroll").css("top",-1*T(this).scrollTop()),e.find(".sc_header_scroll").css("left",-1*T(this).scrollLeft())});for(var l=-1,s=i;s<a;s+=t.widthTime)if(l<0||Math.floor(l/3600)!==Math.floor(s/3600)){n="",n+='<div class="sc_time">'+v.formatTime(s)+"</div>";var d=T(n),r=Number(Math.min(3600*Math.ceil((s+t.widthTime)/3600),a)-s),o=Math.floor(r/t.widthTime);d.width(o*t.widthTimeX),e.find(".sc_header_scroll").append(d),l=s}for(var c in T(window).on("resize",function(){v._resizeWindow.apply(e)}).trigger("resize"),t.rows)v._addRow.apply(e,[c,t.rows[c]])})}};T.fn.timeSchedule=function(e){return v[e]?v[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!==_typeof(e)&&e?(T.error("Method "+e+" does not exist on jQuery.timeSchedule"),this):v.init.apply(this,arguments)}}(jQuery);
//# sourceMappingURL=jq.schedule.min.js.map
